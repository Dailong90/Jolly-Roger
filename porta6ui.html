<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Enigma – Regole finali</title>
  <style>
    :root {
      --bg-url: url('assets/jolly_bay.jpg'); /* usa il .jpg come nel repo */
      --ok:#10b981; --err:#ef4444;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    /* Blocca lo scroll della pagina */
    html, body { margin:0; padding:0; height:100%; overflow:hidden; }
    body {
      font-family: 'Georgia', 'Times New Roman', serif;
      color:#2e2e2e;
      min-height: 100svh;
      background:#000;
      position: relative;
    }
    body::before{
      content:"";
      position:fixed; inset:0;
      background: var(--bg-url) center / cover no-repeat;
      z-index:-2;
    }
    body::after{
      content:"";
      position:fixed; inset:0;
      background: rgba(0,0,0,.25);
      z-index:-1;
    }

    /* CARD FISSA */
    .wrap {
      position: fixed;
      left: 50%;
      top: 65svh;
      transform: translate(-50%, -50%);
      width: min(560px, 92vw);
      padding: 16px;
    }
    .card{
      width:100%;
      background: #fdf6e3; /* pergamena */
      border: 2px solid #d6c29e;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,.45), inset 0 0 40px rgba(139,69,19,.25);
      font-family: 'Georgia', serif;
      background-image:
        radial-gradient(circle at top left, rgba(255,255,255,0.3), transparent 60%),
        radial-gradient(circle at bottom right, rgba(0,0,0,0.05), transparent 70%);
    }
    .riddle{
      background: rgba(255,255,255,.65);
      border:1px dashed #b2926d;
      border-radius:8px;
      padding:14px 16px;
      margin: 0 0 16px;
      line-height:1.5;
      font-size:8px;
      color:#3b2c20;
      white-space:pre-wrap; /* preserva a capo e spazi */
    }

    /* Bottone giallo antichizzato */
    .actions { display:flex; justify-content:center; }
    button{
      cursor:pointer;
      border:1px solid #8b6b1b;
      border-radius:8px;
      padding:0 16px;
      font-weight:700;
      height:46px;
      background: linear-gradient(180deg, #f5d76e, #d4a017);
      color:#3b2c20;
      font-family: 'Georgia', serif;
      box-shadow: 0 3px 6px rgba(0,0,0,.4), inset 0 2px 4px rgba(255,255,255,.4);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    button:hover{
      transform: translateY(-1px);
      box-shadow: 0 5px 8px rgba(0,0,0,.5), inset 0 2px 4px rgba(255,255,255,.5);
    }

    /* Modale fullscreen immagine */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      display: none;           /* visibile solo quando .open */
      align-items: center;
      justify-content: center;
      padding: 4vw;
      z-index: 999;
    }
    .modal.open { display: flex; }

    .modal__inner{
      position: relative;
      max-width: 92vw;
      max-height: 92vh;
      width: 1200px;          /* limite superiore desktop */
      background: #111;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,.6);
    }
    .modal__img{
      display:block;
      width: 100%;
      height: auto;
      max-height: 92vh;
      object-fit: contain;
      background:#000;
    }
    .modal__close{
      position:absolute;
      top:8px; right:8px;
      border:none;
      height:auto;
      padding:8px 12px;
      line-height:1;
      background:#222;
      color:#f5d76e;
      font-weight:700;
      border-radius:8px;
      box-shadow:none;
    }
    .modal__close:hover{ transform:none; box-shadow:none; background:#2f2f2f; }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" aria-labelledby="titolo-regole">
      <h2 id="titolo-regole" style="margin:0 0 10px; font-size:18px;">Regole</h2>

      <div class="riddle" id="regole-testo">
Regole moviemnto Roger

Roger parte del covo dei Jolly, indicato con la bandiera pirata.
Si muove lungo le linea tratteggiate solo sule caselle numerate.
Per nascondere il tesoro Roger deve effettuare esattemamente 15 passi.
I passi vengono effettuati tra caselle numerate adicenti.
Sono considerate adiecenti le caselle numerate collegate dalle linee tratteggiate; i punti neri non valgono per Roger.

Regole movimento cacciatore

Il cacciatore parte del covo dei Jolly, indicato con la bandiera pirata.
Si muove lungo le linea tratteggiate solo sui punti neri tra le caselle numerate.
Ad ogni turno il cacciatore può fare da 0 a 3 passi.
Terminato il movimento si troverà con una o più caselle numerate adiencenti alla sua posizione.
Il cacciatore deve scegliere una casella numerata e chiedere indizi sul passaggio di Roger.
Nel caso la casella sia presente nel percorso di Roger gli verrà risposto di sì.
Nel caso la casella non sia presente nel percorso di Roger gli verrà risposto di no.
L'inizio del turno del cacciatore, riparte dalla posizione in cui si è fermato il turno precedente.
Il cacciatore può continuare la sua ricerca per un totale di 15 turni.
Effettuato un turno, se saranno presenti altre squadre per chiedere un'indizio, si procederà uno alla volta.
Se dopo 15 turni si necessita di altri 15 indizi per trovare il tesoro, il cacciatore dovrà aspettare 5 minuti per ricominciare.
      </div>

      <div class="actions">
        <button id="btnMap" type="button" aria-haspopup="dialog" aria-controls="modalMap">Mappa</button>
      </div>
    </section>
  </main>

  <!-- Modale mappa -->
  <div id="modalMap" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal__inner">
      <button class="modal__close" type="button" id="btnClose" aria-label="Chiudi (Esc)">Chiudi ✕</button>
      <img class="modal__img" src="assets/lucmap25.png" alt="Mappa della caccia al tesoro" />
    </div>
  </div>

  <script>
    const btnMap = document.getElementById('btnMap');
    const modal = document.getElementById('modalMap');
    const btnClose = document.getElementById('btnClose');

    function openModal(){
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
      // Disabilita l'interazione con lo sfondo via tastiera
      btnClose.focus();
    }
    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
      btnMap.focus();
    }

    btnMap.addEventListener('click', openModal);
    btnClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
      // chiude se si clicca fuori dal contenitore
      if (e.target === modal) closeModal();
    });
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('open')) closeModal();
    });
  </script>
</body>
</html>
