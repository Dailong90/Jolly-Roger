<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Enigma – Regole mappa mondo</title>
  <!-- Bootstrap Icons (per il caret) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    :root { --bg-url: url('assets/jolly_bay.jpg'); }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    html, body { margin:0; padding:0; height:100%; overflow:hidden; }
    body{
      font-family:'Georgia','Times New Roman',serif; color:#2e2e2e;
      background:#000; min-height:100svh; position:relative;
    }
    body::before{ content:""; position:fixed; inset:0; background:var(--bg-url) center/cover no-repeat; z-index:-2; }
    body::after { content:""; position:fixed; inset:0; background:rgba(0,0,0,.25); z-index:-1; }

    .wrap{
      position:fixed; left:50%; top:65svh; transform:translate(-50%,-50%);
      width:min(560px,92vw); padding:16px;
    }

    .card{
      display:flex; flex-direction:column; gap:10px;
      background:#fdf6e3; border:2px solid #d6c29e; border-radius:12px; padding:12px;
      box-shadow:0 8px 24px rgba(0,0,0,.45), inset 0 0 40px rgba(139,69,19,.25);
      background-image:
        radial-gradient(circle at top left, rgba(255,255,255,0.3), transparent 60%),
        radial-gradient(circle at bottom right, rgba(0,0,0,0.05), transparent 70%);
      max-height:58svh; /* leggermente più stretta in verticale */
    }

    .card__head{
      display:flex; align-items:center; justify-content:space-between; gap:10px; padding:2px 4px 0;
    }
    .card__title{ margin:0; font-size:18px; line-height:1.2; color:#3b2c20; }

    /* BOX SCORREVOLE con overlay fisse */
    .riddle{
      position:relative; border:1px dashed #b2926d; border-radius:8px;
      background:rgba(255,255,255,.65);
      /* Grid per sovrapporre overlay allo scroller */
      display:grid;
    }
    /* area scorrevole vera e propria */
    .riddle__scroller{
      grid-area:1 / 1; /* sotto alle overlay */
      overflow:auto; -webkit-overflow-scrolling:touch;
      padding:14px 16px 32px; /* spazio extra in basso per non coprire l’ultimo rigo */
      line-height:1.5; font-size:16px; color:#3b2c20; white-space:pre-wrap;
      max-height:40svh; /* determina quanto si può scorrere dentro la card */
    }

    /* SFUMATURA FISSA IN BASSO */
    .riddle__fade{
      grid-area:1 / 1; align-self:end;
      height:84px; /* più grande */
      background:linear-gradient(to top, rgba(253,246,227,0.96), rgba(253,246,227,0));
      border-radius:0 0 8px 8px;
      pointer-events:none; z-index:2; opacity:1; transition:opacity .2s ease;
    }

    /* CARET FISSO IN BASSO */
    .riddle__indicator{
      grid-area:1 / 1; justify-self:center; align-self:end;
      transform:translateY(-10px);
      font-size:26px; color:#6b5b4b; z-index:3; pointer-events:none;
      animation:bounce 1.2s infinite;
      opacity:1; transition:opacity .2s ease;
    }
    @keyframes bounce { 0%,100%{ transform:translateY(-10px); } 50%{ transform:translateY(-4px); } }

    /* Stati: niente scroll o fine scroll => nasconde overlay */
    .riddle.--no-scroll .riddle__fade,
    .riddle.--no-scroll .riddle__indicator,
    .riddle.--at-bottom .riddle__fade,
    .riddle.--at-bottom .riddle__indicator { opacity:0; }

    .btn{
      cursor:pointer; border:1px solid #8b6b1b; border-radius:8px; padding:10px 14px; font-weight:700;
      background:linear-gradient(180deg,#f5d76e,#d4a017); color:#3b2c20; font-family:'Georgia',serif;
      box-shadow:0 3px 6px rgba(0,0,0,.4), inset 0 2px 4px rgba(255,255,255,.4);
      transition:transform .15s, box-shadow .15s; white-space:nowrap;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 5px 8px rgba(0,0,0,.5), inset 0 2px 4px rgba(255,255,255,.5); }

    /* Modale mappa */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; padding:4vw; z-index:999; }
    .modal.open{ display:flex; }
    .modal__inner{ position:relative; max-width:92vw; max-height:92vh; width:1200px; background:#111; border-radius:12px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.6); }
    .modal__img{ display:block; width:100%; height:auto; max-height:92vh; object-fit:contain; background:#000; }
    .modal__close{ position:absolute; top:8px; right:8px; border:none; padding:8px 12px; line-height:1; background:#222; color:#f5d76e; font-weight:700; border-radius:8px; cursor:pointer; }
    .modal__close:hover{ background:#2f2f2f; }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" aria-labelledby="titolo-regole">
      <div class="card__head">
        <h2 id="titolo-regole" class="card__title">Indicazioni</h2>
        <button id="btnMap" type="button" class="btn" aria-haspopup="dialog" aria-controls="modalMap">Bacheca</button>
      </div>

      <!-- Testo scorrevole + overlay fisse -->
      <div class="riddle" id="riddleBox">
        <div class="riddle__scroller" id="riddleScroll">
Mi ricordo che:

-Teheran è stata visitata solo dopo il 1991.
-Tokyo è avvenuta esattamente 4 anni dopo Katmandu.
-Dakar è stata visitata negli anni ’80.
-Tra Teheran e Tokyo c’è  una sola tappa in mezzo.
-L’Avana è successiva a Teheran, ma non è negli anni 2000.
-Dopo Tokyo ho visto Seattle.
        </div>

        <!-- overlay fisse -->
        <div class="riddle__fade" aria-hidden="true"></div>
        <div class="riddle__indicator" aria-hidden="true"><i class="bi bi-caret-down-fill"></i></div>
      </div>
    </section>
  </main>

  <!-- Modale mappa -->
  <div id="modalMap" class="modal" role="dialog" aria-modal="true" aria-label="Mappa del mondo" aria-hidden="true">
    <div class="modal__inner">
      <button class="modal__close" type="button" id="btnClose" aria-label="Chiudi (Esc)">Chiudi ✕</button>
      <img class="modal__img" src="assets/world_map.png" alt="Mappa del mondo" />
    </div>
  </div>

  <script>
    // Modale
    const btnMap  = document.getElementById('btnMap');
    const modal   = document.getElementById('modalMap');
    const btnClose= document.getElementById('btnClose');

    function openModal(){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); btnClose && btnClose.focus(); }
    function closeModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); btnMap && btnMap.focus(); }
    btnMap.addEventListener('click', openModal);
    btnClose?.addEventListener('click', closeModal);
    modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });
    window.addEventListener('keydown', e => { if (e.key === 'Escape' && modal.classList.contains('open')) closeModal(); });

    // Overlay scroll
    const riddleBox = document.getElementById('riddleBox');
    const scroller  = document.getElementById('riddleScroll');

    function updateOverlay(){
      const canScroll = scroller.scrollHeight > scroller.clientHeight + 1;
      riddleBox.classList.toggle('--no-scroll', !canScroll);

      const atBottom = scroller.scrollTop + scroller.clientHeight >= scroller.scrollHeight - 1;
      riddleBox.classList.toggle('--at-bottom', atBottom);
    }

    scroller.addEventListener('scroll', updateOverlay);
    // inizializza dopo layout e su resize/orientamento
    window.addEventListener('load', () => { requestAnimationFrame(updateOverlay); });
    window.addEventListener('resize', () => { requestAnimationFrame(updateOverlay); });
  </script>
</body>
</html>
