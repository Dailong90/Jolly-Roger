<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Enigma – Mappa del Mondo</title>
  <style>
    :root{
      --bg-url: url('assets/world_map.png'); /* immagine intera, senza tagli */
      --ok:#10b981; --err:#ef4444;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    html, body { margin:0; padding:0; height:100%; }
    body{
      font-family: 'Georgia','Times New Roman',serif;
      color:#2e2e2e;
      min-height:100svh;
      background:#000;         /* bande laterali/alto-basso se necessario */
      position:relative;
      overflow:auto;           /* permetti eventuale scroll se l’immagine è alta */
    }

    /* SFONDO: immagine sempre intera (contain), centrata, senza tagli */
    body::before{
      content:"";
      position:fixed; inset:0;
      background: var(--bg-url) center center / contain no-repeat;
      z-index:-2;
    }

    /* leggero velo per leggere meglio la card, ma lasciamo la mappa nitida */
    body::after{
      content:"";
      position:fixed; inset:0;
      background: linear-gradient(to top, rgba(0,0,0,.28), rgba(0,0,0,.10) 40%, rgba(0,0,0,.0) 70%);
      z-index:-1;
      pointer-events:none;
    }

    /* CARD in basso, centrata */
    .wrap{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: max(16px, env(safe-area-inset-bottom) + 12px);
      width:min(820px, 94vw);
      padding:0 8px; /* micro respiro ai lati su mobile */
    }

    .card{
      width:100%;
      background:#fdf6e3;
      border:2px solid #d6c29e;
      border-radius:12px;
      padding:20px;
      box-shadow:0 8px 24px rgba(0,0,0,.45), inset 0 0 40px rgba(139,69,19,.25);
      font-family:'Georgia',serif;
      backdrop-filter:saturate(1.1);
      background-image:
        radial-gradient(circle at top left, rgba(255,255,255,0.35), transparent 60%),
        radial-gradient(circle at bottom right, rgba(0,0,0,0.05), transparent 70%);
    }

    .riddle{
      background:rgba(255,255,255,.65);
      border:1px dashed #b2926d;
      border-radius:8px;
      padding:14px 16px;
      margin:0 0 16px;
      line-height:1.5;
      font-size:16px;
      color:#3b2c20;
    }

    .field{ display:flex; gap:10px; }
    input[type="text"]{
      flex:1; background:#fff8e1;
      border:1px solid #b2926d; color:#2e2e2e;
      border-radius:8px; padding:12px 14px;
      outline:none; font-size:16px; height:46px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,.2);
    }
    input[type="text"]:focus{ border-color:#c9a85b; box-shadow:0 0 6px rgba(201,168,91,.6); }

    button{
      cursor:pointer;
      border:1px solid #8b6b1b;
      border-radius:8px;
      padding:0 16px;
      font-weight:700;
      height:46px;
      background:linear-gradient(180deg,#f5d76e,#d4a017);
      color:#3b2c20;
      font-family:'Georgia',serif;
      box-shadow:0 3px 6px rgba(0,0,0,.4), inset 0 2px 4px rgba(255,255,255,.4);
      transition: transform .15s ease, box-shadow .15s ease;
      white-space:nowrap;
    }
    button:hover{
      transform: translateY(-1px);
      box-shadow: 0 5px 8px rgba(0,0,0,.5), inset 0 2px 4px rgba(255,255,255,.5);
    }

    .tip{ font-size:12px; color:#6b5b4b; margin:6px 2px 0; font-style:italic; }
    .feedback{ margin-top:10px; font-weight:700; min-height:1.4em; text-align:center; }
    .ok{ color:var(--ok); }
    .err{ color:var(--err); }

    /* touch-friendly spacing su schermi piccoli */
    @media (max-width:420px){
      .card{ padding:16px; }
      .riddle{ font-size:15px; }
      input[type="text"]{ font-size:15px; height:44px; }
      button{ height:44px; }
    }
  </style>
</head>
<body>
  <!-- Card bassa -->
  <main class="wrap" role="main">
    <section class="card" aria-labelledby="enigma-title">
      <div class="riddle" id="riddle">
        <h2 id="enigma-title" style="margin:0 0 8px; font-size:18px;">Enigma</h2>
        <p>
          Rotte tracciate senza un capitano,<br/>
          cercando il segno nel silenzio umano;<br/>
          segui i confini dove il blu si placa,<br/>
          e ciò che resta… la risposta svelata.
        </p>
        <p class="no-autolink" name="format-detection" content="telephone=no">Sequenza: 20 - 88 - 5 - 53 - 28 - 68 - 53</p>
      </div>

      <form id="solveForm" autocomplete="off">
        <label for="answer" class="tip">Maiuscole, accenti e spazi non contano.</label>
        <div class="field">
          <input id="answer" name="answer" type="text" placeholder="Soluzione…" required />
          <button id="btnCheck" type="submit" aria-label="Verifica soluzione">Verifica</button>
        </div>
        <div id="feedback" class="feedback" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <script>
    /* Sostituisci con l’hash della soluzione normalizzata */
    const HASH_EXPECTED = "ee4db9c9644f23fdf8475f4d8ceb7e07eeb8d1da53538d37126c6fe4a26abed3";
    const SUCCESS_URL = "isola2ar.html";

    function normalize(str){
      return str.trim().toLowerCase().normalize('NFKD')
        .replace(/\p{Diacritic}/gu,'')
        .replace(/[^\p{L}\p{N}]+/gu,'');
    }

    async function sha256Hex(input){
      const enc = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    const form = document.getElementById('solveForm');
    const input = document.getElementById('answer');
    const feedback = document.getElementById('feedback');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      feedback.textContent = '';
      const value = normalize(input.value);
      if (!value) return;
      const hash = await sha256Hex(value);
      if (hash === HASH_EXPECTED){
        feedback.textContent = '✅ Corretto!';
        feedback.className = 'feedback ok';
        if (SUCCESS_URL) setTimeout(()=>{ window.location.href = SUCCESS_URL; }, 600);
      } else {
        feedback.textContent = '❌ Errato. Riprova!';
        feedback.className = 'feedback err';
      }
    });

    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') form.requestSubmit(); });
  </script>
</body>
</html>
