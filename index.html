<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Enigma – Caccia al Tesoro</title>
  <style>
    :root {
      --bg-url: url('Jolly-Roger/assets/jolly_bay.jpg');
      --muted:#cbd5e1; --ok:#10b981; --err:#ef4444; --accent:#22d3ee;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    /* Layout mobile centrato */
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      color: #e5e7eb;
      min-height: 100svh; /* migliore su mobile */
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow-x: hidden;
      background: #000; /* fallback */
    }
    /* Sfondo + overlay per leggibilità */
    body::before {
      content: "";
      position: fixed; inset: 0;
      background: var(--bg-url) center / cover no-repeat;
      z-index: -2;
    }
    body::after {
      content: "";
      position: fixed; inset: 0;
      background: rgba(0,0,0,.45);
      z-index: -1;
      backdrop-filter: blur(1.5px);
    }

    .wrap { width: min(560px, 92vw); padding: 16px; }
    .card {
      width: 100%;
      background: rgba(15, 23, 42, 0.82);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
    }

    p.lead { color: var(--muted); margin: 0 0 12px; font-size: 16px; }
    .riddle { background:#0b1222; border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:14px 16px; margin: 10px 0 16px; line-height:1.5; font-size:16px; }

    .field { display:flex; gap:10px; }
    input[type="text"]{
      flex:1; background:#0b1222; border:1px solid rgba(255,255,255,.18); color:#e5e7eb; border-radius:12px; padding:12px 14px; outline:none; font-size:16px; height:46px;
    }
    input[type="text"]:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(34,211,238,.18); }
    button { cursor:pointer; border:0; border-radius:12px; padding:0 16px; font-weight:700; height:46px; background: linear-gradient(135deg, #06b6d4, #3b82f6); color:white; flex:0 0 auto; }

    .tip { font-size:12px; color: var(--muted); margin:6px 2px 0; }
    .feedback { margin-top:10px; font-weight:700; min-height:1.4em; }
    .ok { color: var(--ok); }
    .err { color: var(--err); }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <p class="lead">Inserisci la soluzione per sbloccare la prossima tappa.</p>

      <div class="riddle" id="riddle">
        Sono una chiave senza denti, apro porte senza serrature. Mi vedi dopo la pioggia, ma non mi puoi toccare. Chi sono?
      </div>

      <form id="solveForm" autocomplete="off">
        <label for="answer" class="tip">Maiuscole, accenti e spazi non contano.</label>
        <div class="field">
          <input id="answer" name="answer" type="text" placeholder="Scrivi qui la soluzione…" required />
          <button id="btnCheck" type="submit">Verifica</button>
        </div>
        <div id="feedback" class="feedback" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <script>
    // ================== CONFIGURA QUI ==================
    const HASH_EXPECTED = "2f886f22a19006e4f7e47c0b03242536fec344e326181ac311117f7f8a988cad"; // hash della soluzione
    const SUCCESS_URL = ""; // es. "step2.html"
    // ===================================================

    function normalize(str) {
      return str.trim().toLowerCase().normalize('NFKD')
        .replace(/\p{Diacritic}/gu, '')
        .replace(/[^\p{L}\p{N}]+/gu, '');
    }

    async function sha256Hex(input) {
      const enc = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    const form = document.getElementById('solveForm');
    const input = document.getElementById('answer');
    const feedback = document.getElementById('feedback');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      feedback.textContent = '';
      const value = normalize(input.value);
      if (!value) return;
      const hash = await sha256Hex(value);
      if (hash === HASH_EXPECTED) {
        feedback.textContent = '✅ Corretto!';
        feedback.className = 'feedback ok';
        if (SUCCESS_URL) setTimeout(()=>{ window.location.href = SUCCESS_URL; }, 600);
      } else {
        feedback.textContent = '❌ Errato. Riprova!';
        feedback.className = 'feedback err';
      }
    });

    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') form.requestSubmit(); });
  </script>
</body>
</html>
