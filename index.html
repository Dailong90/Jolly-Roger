<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Jolly Roger – Enigma 1</title>
  <!-- Font "Pirata One" per lo stile pirati + Inter per testi -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Pirata+One&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg-url: url('assets/caribbean-bay.jpg'); /* Sostituisci con la tua immagine (repo: /assets/caribbean-bay.jpg) */
      --overlay: rgba(3, 7, 18, .58);
      --muted:#cbd5e1; --ok:#10b981; --err:#ef4444; --accent:#22d3ee;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html, body{ height:100%; }
    body{
      margin:0; background:#0b1222; color:#e5e7eb; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    /* Wrapper mobile full screen */
    .screen{
      min-height:100dvh; display:grid; grid-template-rows:auto 1fr; 
      background-image: var(--bg-url), radial-gradient(1200px 600px at 20% 0%, #0b1229, #0b1222);
      background-size: cover; background-position:center; background-repeat:no-repeat;
      position:relative;
    }
    .screen::before{ /* overlay per leggibilità */
      content:""; position:absolute; inset:0; background:var(--overlay);
      backdrop-filter: blur(2px);
    }

    /* Avviso per desktop/tablet: solo smartphone */
    .only-mobile{ display:none; }
    @media (min-width: 768px){
      .only-mobile{ display:flex; align-items:center; justify-content:center; position:fixed; inset:0; background:#0b1222; color:#fff; z-index:9999; padding:24px; text-align:center; }
    }

    header{
      position:relative; z-index:1; padding:16px 16px 8px; text-align:center;
    }
    .brand{
      font-family: 'Pirata One', serif; font-size: clamp(32px, 8vw, 56px); line-height:1; letter-spacing:.5px;
      text-shadow: 0 2px 0 rgba(0,0,0,.35), 0 8px 28px rgba(0,0,0,.55);
    }

    main{ position:relative; z-index:1; display:grid; place-items:center; padding: 10px 14px 24px; }
    .card{
      width:min(560px, 92vw); border-radius:18px; padding:18px; background: rgba(15, 23, 42, .78);
      border:1px solid rgba(255,255,255,.08); box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    h2{ font-size: clamp(18px, 5.6vw, 24px); margin: 0 0 8px; }
    p.lead{ color: var(--muted); margin:0 0 12px; font-size: clamp(14px, 4vw, 16px); }

    .riddle{ background: rgba(2, 6, 23, .66); border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:12px 14px; margin: 10px 0 14px; line-height:1.5; font-size: clamp(14px, 4.2vw, 16px);
    }

    .field{ display:flex; gap:8px; }
    input[type="text"]{
      flex:1; background:#0b1222; border:1px solid rgba(255,255,255,.18); color:#e5e7eb;
      border-radius:12px; padding:12px 14px; outline:none; font-size:16px; height:46px;
    }
    input[type="text"]:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(34,211,238,.18); }
    button{ cursor:pointer; border:0; border-radius:12px; padding:0 14px; font-weight:700; height:46px;
      background: linear-gradient(135deg, #06b6d4, #3b82f6); color:white; flex:0 0 auto;
    }

    .tip{ font-size:12px; color: var(--muted); margin:10px 2px; }
    .feedback{ margin-top:10px; font-weight:700; min-height:1.4em; }
    .ok{ color: var(--ok); }
    .err{ color: var(--err); }

    footer{ position:relative; z-index:1; text-align:center; padding:8px; font-size:12px; color:#93c5fd; opacity:.8; }
  </style>
</head>
<body>
  <div class="only-mobile">
    <div>
      <h2>Apri da smartphone</h2>
      <p>Questa esperienza è ottimizzata solo per telefono verticale.</p>
    </div>
  </div>

  <div class="screen">
    <header>
      <div class="brand">Jolly Roger</div>
    </header>

    <main>
      <section class="card">
        <h2>Enigma 1</h2>
        <p class="lead">Inserisci la soluzione per sbloccare la prossima tappa.</p>

        <div class="riddle" id="riddle">
          <!-- Sostituisci con la tua descrizione -->
          Sulle mappe dei pirati non sono mai dove appaio, ma senza di me nessun tesoro troverai. Chi sono?
        </div>

        <form id="solveForm" autocomplete="off">
          <label for="answer" class="tip">Maiuscole/accénti/spazi non contano.</label>
          <div class="field">
            <input id="answer" name="answer" type="text" placeholder="Scrivi qui la soluzione…" required />
            <button id="btnCheck" type="submit">Verifica</button>
          </div>
          <div id="feedback" class="feedback" aria-live="polite"></div>
        </form>
      </section>
    </main>

    <footer>
      Tappa 1 di 4
    </footer>
  </div>

  <script>
    // ================== CONFIGURA QUI (TAPPA 1) ==================
    // SHA-256 della risposta normalizzata. Default = "tesoro"
    const HASH_EXPECTED = "5cf0c40b6191ab10ea4b728f3d81b9af66230e4a75d75190a71fba22d7a95381";
    // URL della tappa successiva (crea poi step2.html nello stesso repo)
    const SUCCESS_URL = "step2.html";
    // =============================================================

    function normalize(str){
      return str.trim().toLowerCase().normalize('NFKD')
        .replace(/\p{Diacritic}/gu, '')
        .replace(/[^\p{L}\p{N}]+/gu, '');
    }

    async function sha256Hex(input){
      const enc = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    const form = document.getElementById('solveForm');
    const input = document.getElementById('answer');
    const feedback = document.getElementById('feedback');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      feedback.textContent = '';
      const value = normalize(input.value);
      if (!value) return;
      const hash = await sha256Hex(value);
      if (hash === HASH_EXPECTED){
        feedback.textContent = '✅ Corretto! Rotta tracciata…';
        feedback.className = 'feedback ok';
        setTimeout(()=>{ window.location.href = SUCCESS_URL; }, 600);
      } else {
        feedback.textContent = '❌ Errato. Riprova, mozzo!';
        feedback.className = 'feedback err';
      }
    });

    // Invio con Enter
    input.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') form.requestSubmit(); });

    // ISTRUZIONI PER CAMBIARE LA RISPOSTA:
    // Apri la console (F12) sulla pagina pubblicata e incolla:
    // const normalize = s => s.trim().toLowerCase().normalize('NFKD').replace(/\p{Diacritic}/gu,'').replace(/[^\p{L}\p{N}]+/gu,'');
    // const hex = b => [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,'0')).join('');
    // hex(await crypto.subtle.digest('SHA-256', new TextEncoder().encode(normalize('TUA_SOLUZIONE'))))
    // Copia l'hash e sostituisci HASH_EXPECTED.
  </script>
</body>
</html>
