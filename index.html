<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Enigma – Caccia al Tesoro</title>
  <style>
    :root {
      --bg-url: url('assets/jolly_bay.jpg'); /* percorso corretto */
      --ok:#10b981; --err:#ef4444;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin:0; padding:0; }
    body {
      font-family: 'Georgia', 'Times New Roman', serif;
      color:#2e2e2e;
      min-height: 100svh;
      background:#000;
      position: relative;
      overflow-x: hidden;
    }
    /* Sfondo nitido con overlay leggero */
    body::before{
      content:"";
      position:fixed; inset:0;
      background: var(--bg-url) center / cover no-repeat;
      z-index:-2;
    }
    body::after{
      content:"";
      position:fixed; inset:0;
      background: rgba(0,0,0,.25);
      z-index:-1;
    }

    .wrap {
      width: min(560px, 92vw);
      margin: 30vh auto 8vh; /* spinge la card verso il basso */
      padding: 16px;
    }
    .card{
      width:100%;
      background: #fdf6e3; /* pergamena */
      border: 2px solid #d6c29e;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,.45), inset 0 0 40px rgba(139,69,19,.25);
      font-family: 'Georgia', serif;
      background-image: radial-gradient(circle at top left, rgba(255,255,255,0.3), transparent 60%), 
                        radial-gradient(circle at bottom right, rgba(0,0,0,0.05), transparent 70%);
    }

    p.lead { color: #5b4636; margin:0 0 12px; font-size:16px; text-align:center; font-weight:bold; }
    .riddle{
      background: rgba(255,255,255,.65);
      border:1px dashed #b2926d;
      border-radius:8px;
      padding:14px 16px;
      margin: 10px 0 16px;
      line-height:1.5;
      font-size:16px;
      color:#3b2c20;
    }

    .field{ display:flex; gap:10px; }
    input[type="text"]{
      flex:1; background:#fff8e1;
      border:1px solid #b2926d; color:#2e2e2e;
      border-radius:8px; padding:12px 14px;
      outline:none; font-size:16px; height:46px;
      box-shadow: inset 0 1px 3px rgba(0,0,0,.2);
    }
    input[type="text"]:focus{ border-color: #c9a85b; box-shadow: 0 0 6px rgba(201,168,91,.6); }
    button{
      cursor:pointer;
      border:1px solid #8b6b1b;
      border-radius:8px;
      padding:0 16px;
      font-weight:700;
      height:46px;
      background: linear-gradient(180deg, #f5d76e, #d4a017);
      color:#3b2c20;
      font-family: 'Georgia', serif;
      box-shadow: 0 3px 6px rgba(0,0,0,.4), inset 0 2px 4px rgba(255,255,255,.4);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    button:hover{
      transform: translateY(-1px);
      box-shadow: 0 5px 8px rgba(0,0,0,.5), inset 0 2px 4px rgba(255,255,255,.5);
    }

    .tip { font-size:12px; color: #6b5b4b; margin:6px 2px 0; font-style:italic; }
    .feedback { margin-top:10px; font-weight:700; min-height:1.4em; text-align:center; }
    .ok { color: var(--ok); }
    .err { color: var(--err); }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <p class="lead">Inserisci la soluzione per sbloccare la prossima tappa.</p>

      <div class="riddle" id="riddle">
        Sono una chiave senza denti, apro porte senza serrature. Mi vedi dopo la pioggia, ma non mi puoi toccare. Chi sono?
      </div>

      <form id="solveForm" autocomplete="off">
        <label for="answer" class="tip">Maiuscole, accenti e spazi non contano.</label>
        <div class="field">
          <input id="answer" name="answer" type="text" placeholder="Scrivi qui la soluzione…" required />
          <button id="btnCheck" type="submit">Verifica</button>
        </div>
        <div id="feedback" class="feedback" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <script>
    const HASH_EXPECTED = "2f886f22a19006e4f7e47c0b03242536fec344e326181ac311117f7f8a988cad"; // hash della soluzione
    const SUCCESS_URL = ""; // es. "step2.html"

    function normalize(str) {
      return str.trim().toLowerCase().normalize('NFKD')
        .replace(/\\p{Diacritic}/gu, '')
        .replace(/[^\\p{L}\\p{N}]+/gu, '');
    }

    async function sha256Hex(input) {
      const enc = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    const form = document.getElementById('solveForm');
    const input = document.getElementById('answer');
    const feedback = document.getElementById('feedback');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      feedback.textContent = '';
      const value = normalize(input.value);
      if (!value) return;
      const hash = await sha256Hex(value);
      if (hash === HASH_EXPECTED) {
        feedback.textContent = '✅ Corretto!';
        feedback.className = 'feedback ok';
        if (SUCCESS_URL) setTimeout(()=>{ window.location.href = SUCCESS_URL; }, 600);
      } else {
        feedback.textContent = '❌ Errato. Riprova!';
        feedback.className = 'feedback err';
      }
    });

    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') form.requestSubmit(); });
  </script>
</body>
</html>
