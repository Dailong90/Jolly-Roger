<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Enigma – Caccia al Tesoro</title>
  <style>
    :root { --bg: #0f172a; --card: #111827; --muted:#94a3b8; --ok:#10b981; --err:#ef4444; --accent:#22d3ee; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; background: radial-gradient(1200px 600px at 20% 0%, #0b1229, var(--bg)); color:#e5e7eb; display:grid; place-items:center; min-height:100vh; }
    .wrap { width: min(720px, 92vw); }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.08); border-radius: 18px; padding: clamp(18px, 4vw, 28px); box-shadow: 0 10px 30px rgba(0,0,0,.35); backdrop-filter: blur(6px); }
    h1 { font-size: clamp(1.4rem, 2.5vw, 2rem); margin:0 0 .4rem; letter-spacing:.3px; }
    p.lead { color: var(--muted); margin:.25rem 0 1rem; }
    .riddle { background:#0b1222; border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:14px 16px; margin: 12px 0 18px; line-height:1.5; }
    .field { display:flex; gap:10px; margin:.25rem 0 0; }
    input[type="text"]{ flex:1; background:#0b1222; border:1px solid rgba(255,255,255,.12); color:#e5e7eb; border-radius:12px; padding:12px 14px; outline:none; font-size:1rem; }
    input[type="text"]:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(34,211,238,.18); }
    button { cursor:pointer; border:0; border-radius:12px; padding:12px 16px; font-weight:600; background: linear-gradient(135deg, #06b6d4, #3b82f6); color:white; }
    .tip { font-size:.95rem; color: var(--muted); margin:8px 2px; }
    .feedback { margin-top:12px; font-weight:600; min-height:1.4em; }
    .ok { color: var(--ok); }
    .err { color: var(--err); }
    .footer { margin-top:20px; font-size:.9rem; color: #93c5fd; opacity:.8 }
    .hide { display:none; }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>Enigma #1</h1>
      <p class="lead">Trova la parola segreta. Inserisci la soluzione per continuare.</p>

      <div class="riddle" id="riddle">
        Sono una chiave senza denti, apro porte senza serrature. Mi vedi dopo la pioggia, ma non mi puoi toccare. Chi sono?
      </div>

      <form id="solveForm" autocomplete="off">
        <label for="answer" class="tip">La soluzione non distingue maiuscole/minuscole, accenti e spazi.</label>
        <div class="field">
          <input id="answer" name="answer" type="text" placeholder="Scrivi qui la soluzione…" required />
          <button id="btnCheck" type="submit">Verifica</button>
        </div>
        <div id="feedback" class="feedback" aria-live="polite"></div>
      </form>

      <p class="footer">Suggerimento per l'organizzatore: sostituisci l'indovinello e configura la risposta nel codice.</p>
    </section>
  </main>

  <script>
    // ================== CONFIGURA QUI ==================
    // 1) HASH della risposta corretta (SHA-256 esadecimale della risposta "normalizzata").
    //    Di default è impostato alla parola "soluzione" per prova.
    //    Sostituiscilo seguendo le istruzioni più sotto.
    const HASH_EXPECTED = "2f886f22a19006e4f7e47c0b03242536fec344e326181ac311117f7f8a988cad";

    // 2) (Opzionale) URL della tappa successiva da aprire se la risposta è corretta.
    const SUCCESS_URL = ""; // es. "https://tuo-sito/step2.html"
    // ===================================================

    // Normalizza l'input: minuscolo, niente accenti, niente spazi/punteggiatura
    function normalize(str) {
      return str
        .trim()
        .toLowerCase()
        .normalize('NFKD')
        .replace(/\p{Diacritic}/gu, '')
        .replace(/[^\p{L}\p{N}]+/gu, '');
    }

    // SHA-256 → hex string
    async function sha256Hex(input) {
      const enc = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    const form = document.getElementById('solveForm');
    const input = document.getElementById('answer');
    const feedback = document.getElementById('feedback');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      feedback.textContent = '';
      const value = normalize(input.value);
      if (!value) return;

      try {
        const hash = await sha256Hex(value);
        if (hash === HASH_EXPECTED) {
          feedback.textContent = '✅ Corretto! Ben fatto.';
          feedback.className = 'feedback ok';
          if (SUCCESS_URL) {
            setTimeout(() => { window.location.href = SUCCESS_URL; }, 800);
          }
        } else {
          feedback.textContent = '❌ Risposta errata. Riprova!';
          feedback.className = 'feedback err';
        }
      } catch (err) {
        feedback.textContent = 'Si è verificato un errore. Riprova.';
        feedback.className = 'feedback err';
        console.error(err);
      }
    });

    // Comodità: invio con Enter sempre attivo
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') form.requestSubmit();
    });

    // === ISTRUZIONI PER IMPOSTARE UNA NUOVA RISPOSTA ===
    // Apri la console del browser (F12) e incolla questo snippet, sostituendo TUA_SOLUZIONE
    // con la risposta corretta (scritta come vuoi: maiuscole, spazi, accenti... verrà normalizzata):
    //
    // const normalize = s => s.trim().toLowerCase().normalize('NFKD').replace(/\p{Diacritic}/gu,'').replace(/[^\p{L}\p{N}]+/gu,'');
    // const hex = b => [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,'0')).join('');
    // hex(await crypto.subtle.digest('SHA-256', new TextEncoder().encode(normalize('TUA_SOLUZIONE'))))
    //
    // Copia il risultato (una stringa esadecimale) e sostituisci il valore di HASH_EXPECTED sopra.
    // Nota: questo non è "sicurezza" vera — è solo offuscamento lato client.
  </script>
</body>
</html>
