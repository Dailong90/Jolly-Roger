<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Enigma – Caccia al Tesoro</title>
  <style>
    :root {
      --bg-url: url('assets/jolly_bay.jpeg');
      --muted:#94a3b8; --ok:#10b981; --err:#ef4444; --accent:#22d3ee;
    }
    * { box-sizing: border-box; }
    body {
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      background: var(--bg-url) center/cover no-repeat fixed;
      color:#e5e7eb; display:grid; place-items:center; min-height:100vh;
    }
    .wrap { width: min(720px, 92vw); }
    .card {
      background: rgba(15, 23, 42, 0.8);
      border:1px solid rgba(255,255,255,0.08);
      border-radius: 18px;
      padding: clamp(18px, 4vw, 28px);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
    }
    h1 { font-size: clamp(1.4rem, 2.5vw, 2rem); margin:0 0 .4rem; letter-spacing:.3px; }
    p.lead { color: var(--muted); margin:.25rem 0 1rem; }
    .riddle { background:#0b1222; border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:14px 16px; margin: 12px 0 18px; line-height:1.5; }
    .field { display:flex; gap:10px; margin:.25rem 0 0; }
    input[type="text"]{ flex:1; background:#0b1222; border:1px solid rgba(255,255,255,.12); color:#e5e7eb; border-radius:12px; padding:12px 14px; outline:none; font-size:1rem; }
    input[type="text"]:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(34,211,238,.18); }
    button { cursor:pointer; border:0; border-radius:12px; padding:12px 16px; font-weight:600; background: linear-gradient(135deg, #06b6d4, #3b82f6); color:white; }
    .tip { font-size:.95rem; color: var(--muted); margin:8px 2px; }
    .feedback { margin-top:12px; font-weight:600; min-height:1.4em; }
    .ok { color: var(--ok); }
    .err { color: var(--err); }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>Enigma #1</h1>
      <p class="lead">Trova la parola segreta. Inserisci la soluzione per continuare.</p>

      <div class="riddle" id="riddle">
        Sono una chiave senza denti, apro porte senza serrature. Mi vedi dopo la pioggia, ma non mi puoi toccare. Chi sono?
      </div>

      <form id="solveForm" autocomplete="off">
        <label for="answer" class="tip">La soluzione non distingue maiuscole/minuscole, accenti e spazi.</label>
        <div class="field">
          <input id="answer" name="answer" type="text" placeholder="Scrivi qui la soluzione…" required />
          <button id="btnCheck" type="submit">Verifica</button>
        </div>
        <div id="feedback" class="feedback" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <script>
    // ================== CONFIGURA QUI ==================
    const HASH_EXPECTED = "2f886f22a19006e4f7e47c0b03242536fec344e326181ac311117f7f8a988cad";
    const SUCCESS_URL = ""; // es. "https://tuo-sito/step2.html"
    // ===================================================

    function normalize(str) {
      return str
        .trim()
        .toLowerCase()
        .normalize('NFKD')
        .replace(/\p{Diacritic}/gu, '')
        .replace(/[^\p{L}\p{N}]+/gu, '');
    }

    async function sha256Hex(input) {
      const enc = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    const form = document.getElementById('solveForm');
    const input = document.getElementById('answer');
    const feedback = document.getElementById('feedback');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      feedback.textContent = '';
      const value = normalize(input.value);
      if (!value) return;

      try {
        const hash = await sha256Hex(value);
        if (hash === HASH_EXPECTED) {
          feedback.textContent = '✅ Corretto! Ben fatto.';
          feedback.className = 'feedback ok';
          if (SUCCESS_URL) {
            setTimeout(() => { window.location.href = SUCCESS_URL; }, 800);
          }
        } else {
          feedback.textContent = '❌ Risposta errata. Riprova!';
          feedback.className = 'feedback err';
        }
      } catch (err) {
        feedback.textContent = 'Si è verificato un errore. Riprova.';
        feedback.className = 'feedback err';
        console.error(err);
      }
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') form.requestSubmit();
    });
  </script>
</body>
</html>
